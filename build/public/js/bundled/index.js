require("core-js/stable");var e=require("axios"),t=require("mapbox-gl"),o=module.exports&&module.exports.__awaiter||function(e,t,o,n){return new(o||(o=Promise))(function(a,r){function u(e){try{d(n.next(e))}catch(e){r(e)}}function s(e){try{d(n.throw(e))}catch(e){r(e)}}function d(e){var t;e.done?a(e.value):((t=e.value)instanceof o?t:new o(function(e){e(t)})).then(u,s)}d((n=n.apply(e,t||[])).next())})};Object.defineProperty(module.exports,"__esModule",{value:!0});var n={},a=n&&n.__awaiter||function(e,t,o,n){return new(o||(o=Promise))(function(a,r){function u(e){try{d(n.next(e))}catch(e){r(e)}}function s(e){try{d(n.throw(e))}catch(e){r(e)}}function d(e){var t;e.done?a(e.value):((t=e.value)instanceof o?t:new o(function(e){e(t)})).then(u,s)}d((n=n.apply(e,t||[])).next())})},r=n&&n.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.logout=n.login=void 0;const u=r(e);var s={};Object.defineProperty(s,"__esModule",{value:!0}),s.showAlert=s.hideAlert=void 0,s.hideAlert=()=>{let e=document.querySelector(".alert");e&&e.parentElement.removeChild(e)},s.showAlert=(e,t)=>{(0,s.hideAlert)();let o=`<div class="alert alert--${e}">${t}</div>`;document.querySelector("body").insertAdjacentHTML("afterbegin",o),window.setTimeout(s.hideAlert,5e3)},n.login=(e,t)=>a(void 0,void 0,void 0,function*(){try{let o=yield(0,u.default)({method:"POST",url:"/api/v1/users/login",data:{email:e,password:t}});"success"===o.data.status&&((0,s.showAlert)("success","Logged in successfully!"),window.setTimeout(()=>{location.assign("/")},1500))}catch(e){(0,s.showAlert)("error",e.response.data.message)}}),n.logout=()=>a(void 0,void 0,void 0,function*(){try{let e=yield(0,u.default)({method:"GET",url:"/api/v1/users/logout"});"success"===e.data.status&&location.assign("/")}catch(e){console.log(e.response),(0,s.showAlert)("error","Error logging out! Try again.")}});var d={},i=d&&d.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(d,"__esModule",{value:!0}),d.displayMap=void 0;const l=i(t);d.displayMap=e=>{l.default.accessToken="pk.eyJ1IjoiZG9zYW5qb3NndXN0YXZvIiwiYSI6ImNsbHBmbm15NTA1NWIza2xpMWo4bDlwcTIifQ.vPBJ5o4Txtu9VMAUIjggcQ";var t=new l.default.Map({container:"map",style:"mapbox://styles/dosanjosgustavo/cllv02m31012101qx0uq49ct5",scrollZoom:!1});let o=new l.default.LngLatBounds;e.forEach(e=>{let n=document.createElement("div");n.className="marker",new l.default.Marker({element:n,anchor:"bottom"}).setLngLat(e.coordinates).addTo(t),new l.default.Popup({offset:30}).setLngLat(e.coordinates).setHTML(`<p>Day ${e.day}: ${e.description}</p>`).addTo(t),o.extend(e.coordinates)}),t.fitBounds(o,{padding:{top:200,bottom:150,left:100,right:100}})};var c={},p=c&&c.__awaiter||function(e,t,o,n){return new(o||(o=Promise))(function(a,r){function u(e){try{d(n.next(e))}catch(e){r(e)}}function s(e){try{d(n.throw(e))}catch(e){r(e)}}function d(e){var t;e.done?a(e.value):((t=e.value)instanceof o?t:new o(function(e){e(t)})).then(u,s)}d((n=n.apply(e,t||[])).next())})},m=c&&c.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(c,"__esModule",{value:!0}),c.updateSettings=void 0;const f=m(e);c.updateSettings=(e,t)=>p(void 0,void 0,void 0,function*(){try{let o=yield(0,f.default)({method:"PATCH",url:"password"===t?"/api/v1/users/updateMyPassword":"/api/v1/users/updateMe",data:e}),n=t.charAt(0).toUpperCase()+t.slice(1);"success"===o.data.status&&((0,s.showAlert)("success",`${n} updated successfully!`),window.setTimeout(()=>{location.reload()},1500))}catch(e){(0,s.showAlert)("error",e.response.data.message)}});var v={},y=v&&v.__awaiter||function(e,t,o,n){return new(o||(o=Promise))(function(a,r){function u(e){try{d(n.next(e))}catch(e){r(e)}}function s(e){try{d(n.throw(e))}catch(e){r(e)}}function d(e){var t;e.done?a(e.value):((t=e.value)instanceof o?t:new o(function(e){e(t)})).then(u,s)}d((n=n.apply(e,t||[])).next())})},g=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(v,"__esModule",{value:!0}),v.bookTour=void 0;const w=g(e);v.bookTour=e=>y(void 0,void 0,void 0,function*(){try{// 1) Get checkout session from API + create checkout form
    let t=yield(0,w.default)(`/api/v1/bookings/checkout-session/${e}`);// 2) Redirect to checkout form
    window.location.href=t.data.session.url}catch(e){console.log(e),(0,s.showAlert)("error",e)}});var h={},_=h&&h.__awaiter||function(e,t,o,n){return new(o||(o=Promise))(function(a,r){function u(e){try{d(n.next(e))}catch(e){r(e)}}function s(e){try{d(n.throw(e))}catch(e){r(e)}}function d(e){var t;e.done?a(e.value):((t=e.value)instanceof o?t:new o(function(e){e(t)})).then(u,s)}d((n=n.apply(e,t||[])).next())})},b=h&&h.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(h,"__esModule",{value:!0}),h.signup=void 0;const E=b(e);h.signup=(e,t,o,n)=>_(void 0,void 0,void 0,function*(){try{let a=yield(0,E.default)({method:"POST",url:"/api/v1/users/signup",data:{name:e,email:t,password:o,passwordConfirm:n}});"success"===a.data.status&&((0,s.showAlert)("success","Signed up successfully!"),window.setTimeout(()=>{location.assign("/")},1500))}catch(e){(0,s.showAlert)("error",e.response.data.message)}});// DOM ELEMENTS
const x=document.getElementById("map"),M=document.querySelector(".form--login"),I=document.querySelector(".nav__el--logout"),S=document.querySelector(".form-user-data"),T=document.querySelector(".form-user-password"),A=document.getElementById("book-tour"),P=document.querySelector(".form--signup");if(x){let e=JSON.parse(x.dataset.locations);(0,d.displayMap)(e)}M&&M.addEventListener("submit",e=>{e.preventDefault();let t=document.getElementById("email").value,o=document.getElementById("password").value;(0,n.login)(t,o)}),I&&I.addEventListener("click",n.logout),S&&S.addEventListener("submit",e=>{e.preventDefault();let t=new FormData;t.append("name",document.getElementById("name").value),t.append("email",document.getElementById("email").value),t.append("photo",document.getElementById("photo").files[0]),(0,c.updateSettings)(t,"data")}),T&&T.addEventListener("submit",e=>o(void 0,void 0,void 0,function*(){e.preventDefault();let t=document.querySelector(".btn--save-password"),o=document.getElementById("password-current"),n=document.getElementById("password"),a=document.getElementById("password-confirm");t.textContent="Updating...";let r=o.value,u=n.value,s=a.value;yield(0,c.updateSettings)({passwordCurrent:r,password:u,passwordConfirm:s},"password"),t.textContent="Save password",o.value="",n.value="",a.value=""})),A&&A.addEventListener("click",e=>{// @ts-ignore
e.target.textContent="Processing...",// @ts-ignore
e.target.disabled=!0;// @ts-ignore
let{tourId:t}=e.target.dataset;(0,v.bookTour)(t)}),P&&P.addEventListener("submit",e=>o(void 0,void 0,void 0,function*(){e.preventDefault();let t=document.getElementById("name").value,o=document.getElementById("email").value,n=document.getElementById("password").value,a=document.getElementById("passwordConfirm").value,r=document.querySelector(".btn");r.textContent="Signing up...",// @ts-ignore
    r.disabled=!0,yield(0,h.signup)(t,o,n,a)}));//# sourceMappingURL=index.js.map

//# sourceMappingURL=index.js.map
